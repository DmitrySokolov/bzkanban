<html>
    <head>
        <script type="text/javascript">
            var bzComponent = ""
            var bzPriority = ""
            var bzAssignedTo = ""
            var bzOrder = "priority"
            var bzURL = "";
            var sessionToken = "";
            var bzProduct = "";
            var bzProductMilestone = ""

            //window.onload = loadBoard;
            function doSubmit() {
                bzURL = document.getElementById('textURL').value;
                document.getElementById("board-headings").innerHTML = "";
                document.getElementById("board-cards").innerHTML = "";
                loadBoard();
            }

            function loadBoard() {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState == XMLHttpRequest.DONE) {
                        var response = xhr.responseText;
                        var obj = JSON.parse(response);
                        statuses = obj.values;
                        for (var key in statuses) {
                            status = statuses[key];
                            addBoardColumn(status);
                        }


                        loadBugs();
                    }
                }
                xhr.open("GET", bzURL + "/rest/field/bug/status/values");
                xhr.send();
            }

            function loadBugs() {
                bzProduct = document.getElementById('textProduct').value;
                bzProductMilestone = document.getElementById('textMilestone').value;
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState == XMLHttpRequest.DONE) {
                        var response = xhr.responseText;
                        var obj = JSON.parse(response);
                        bugs = obj.bugs;
                        for (var key in bugs) {
                            bug = bugs[key];
                            addCard(bug);
                        }
                    }
                }
                xhr.open("GET", bzURL + "/rest/bug?product=" + bzProduct + "&include_fields=summary,status,id,severity,priority&order=" + bzOrder + "&target_milestone=" + bzProductMilestone + "&component=" + bzComponent + "&priority=" + bzPriority + "&assigned_to=" + bzAssignedTo);
                xhr.send();
            }

            function addBoardColumn(status) {
                var th = document.createElement('th');
                th.innerHTML = status;
                document.getElementById("board-headings").appendChild(th);

                var td = document.createElement('td');
                td.id = status;
                document.getElementById("board-cards").appendChild(td);
            }

            function addCard(bug) {
                var div = document.createElement('div');
                div.className = bug.severity + " " + bug.priority +" " + "card";
                div.innerHTML = "<a href='" + bzURL + "/show_bug.cgi?id=" + bug.id + "'>#" + bug.id + "</a> " + bug.summary;
                document.getElementById(bug.status).appendChild(div);
            }


        </script>
        <style>
            body {
                background-color: ghostwhite;
            }
            #board {
                width: 100%;
                table-layout: fixed;
            }
            .card {
                background-color: white;
                border-width: 1px;
                border-color: black;
                border-style: dotted;
                padding: 5px;
                margin: 2px;
            }
            .enhancement {
                border-right-color: greenyellow;
                border-right-width: 4px;
                border-right-style: solid;
            }
            .critical {
                border-right-color: red;
                border-right-width: 4px;
                border-right-style: solid;
            }
            .P1 {
                border-left-color: orange;
                border-left-width: 4px;
                border-left-style: solid;
            }
            #board-cards {
                vertical-align: top;
            }
            #input {
                width: 100%;
            }
        </style>
    </head>
    <body>
    <form id="input">
        <span>
            <label for="textURL">Site URL</label>
            <input type="text" id="textURL" value="http://bugzilla.ddk.armysimulation.mil.ca" style="width:250px;">
        </span>
        <span>
            <label for="textProduct">Product</label>
            <input type="text" id="textProduct" value="">
        </span>
        <span>
            <label for="textMilestone">Milestone</label>
            <input type="text" id="textMilestone" value="">
        </span>
        <span>
            <button type="button" id="btnSubmit" onclick="doSubmit()">Submit</button>
        </span>
    </form>
        <table id="board">
            <tr id="board-headings"></tr>
            <tr id="board-cards"></tr>
        </table>
    </body>
</html>
